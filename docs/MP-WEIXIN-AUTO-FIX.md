# å¾®ä¿¡å°ç¨‹åºè‡ªåŠ¨ä¿®å¤è¯´æ˜

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

uni-app ç¼–è¯‘å¾®ä¿¡å°ç¨‹åºæ—¶ï¼Œç”Ÿæˆçš„ `app.json` æ–‡ä»¶å¯èƒ½ä¸å®Œæ•´ï¼Œç¼ºå°‘ `pages`ã€`subPackages`ã€`tabBar` ç­‰é…ç½®ï¼Œå¯¼è‡´å°ç¨‹åºæŠ¥é”™ï¼š"pages ä¸èƒ½ä¸ºç©º"ã€‚

## âœ… å·²æ·»åŠ çš„è‡ªåŠ¨åŒ–è„šæœ¬

### 1. ç”Ÿäº§æ„å»ºï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰

```bash
npm run build:mp-weixin
```

**è¯´æ˜**ï¼šæ­¤å‘½ä»¤ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. ç¼–è¯‘å¾®ä¿¡å°ç¨‹åºç”Ÿäº§ç‰ˆæœ¬
2. è‡ªåŠ¨è¿è¡Œä¿®å¤è„šæœ¬ï¼Œç”Ÿæˆå®Œæ•´çš„ `app.json`
3. å¤‡ä»½åŸå§‹æ–‡ä»¶åˆ° `app-backup.json`

### 2. æ‰‹åŠ¨ä¿®å¤

```bash
npm run fix:mp-weixin
```

**è¯´æ˜**ï¼šç‹¬ç«‹çš„ä¿®å¤è„šæœ¬ï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
- ä½¿ç”¨ HBuilderX ç¼–è¯‘åéœ€è¦ä¿®å¤
- å¼€å‘æ¨¡å¼ç¼–è¯‘åéœ€è¦ä¿®å¤
- ä»»ä½•éœ€è¦é‡æ–°ç”Ÿæˆ `app.json` çš„æƒ…å†µ

## ğŸ”§ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ä½¿ç”¨ HBuilderX ç¼–è¯‘

å¦‚æœæ‚¨ä½¿ç”¨ HBuilderX çš„å¯è§†åŒ–ç•Œé¢ç¼–è¯‘å¾®ä¿¡å°ç¨‹åºï¼š

1. åœ¨ HBuilderX ä¸­ç‚¹å‡»"è¿è¡Œ" -> "è¿è¡Œåˆ°å°ç¨‹åºæ¨¡æ‹Ÿå™¨" -> "å¾®ä¿¡å¼€å‘è€…å·¥å…·"
2. ç¼–è¯‘å®Œæˆåï¼Œè¿è¡Œä¿®å¤å‘½ä»¤ï¼š
   ```bash
   npm run fix:mp-weixin
   ```

### åœºæ™¯ 2: ä½¿ç”¨å‘½ä»¤è¡Œç”Ÿäº§æ„å»º

ç›´æ¥ä½¿ç”¨è‡ªåŠ¨åŒ–å‘½ä»¤ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®å¤ï¼š

```bash
npm run build:mp-weixin
```

### åœºæ™¯ 3: å¼€å‘æ¨¡å¼

å¼€å‘æ¨¡å¼ä½¿ç”¨ watch ç›‘å¬ï¼Œæ— æ³•è‡ªåŠ¨ä¿®å¤ã€‚ç¼–è¯‘åæ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# åœ¨ HBuilderX ä¸­å¯åŠ¨å¼€å‘æ¨¡å¼
# æˆ–è¿è¡Œ: npm run dev:mp-weixin

# ç¼–è¯‘å®Œæˆåï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œä¿®å¤
npm run fix:mp-weixin
```

## ğŸ“ ä¿®å¤è„šæœ¬åšäº†ä»€ä¹ˆ

`tools/fix-mp-weixin-build.js` è„šæœ¬ä¼šï¼š

1. âœ… è¯»å–é¡¹ç›®æ ¹ç›®å½•çš„ `pages.json` é…ç½®
2. âœ… å°† uni-app æ ¼å¼è½¬æ¢ä¸ºå¾®ä¿¡å°ç¨‹åº `app.json` æ ¼å¼
3. âœ… ç”Ÿæˆå®Œæ•´çš„é…ç½®é¡¹ï¼š
   - `pages`: ä¸»åŒ…é¡µé¢è·¯å¾„
   - `subPackages`: åˆ†åŒ…é…ç½®
   - `window`: å…¨å±€çª—å£æ ·å¼
   - `tabBar`: åº•éƒ¨å¯¼èˆªæ 
   - `usingComponents`: å…¨å±€ç»„ä»¶
4. âœ… å¤‡ä»½åŸå§‹æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
5. âœ… å†™å…¥æ–°çš„ `app.json` åˆ°ç¼–è¯‘ç›®å½•

## ğŸ¯ éªŒè¯ä¿®å¤ç»“æœ

ä¿®å¤å®Œæˆåï¼Œæ£€æŸ¥æ–‡ä»¶ `unpackage/dist/dev/mp-weixin/app.json` åº”è¯¥åŒ…å«ï¼š

```json
{
  "pages": [
    "pages/home/home",
    "pages/user/home",
    // ... æ›´å¤šé¡µé¢
  ],
  "subPackages": [
    {
      "root": "pages-sub/assess",
      "name": "assess",
      "pages": ["result", "academic/index", ...]
    },
    // ... æ›´å¤šåˆ†åŒ…
  ],
  "window": { ... },
  "tabBar": { ... },
  "usingComponents": { ... }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¯æ¬¡ç¼–è¯‘åéƒ½éœ€è¦ä¿®å¤**ï¼šå¦‚æœä½¿ç”¨ HBuilderX ç¼–è¯‘ï¼Œæ¯æ¬¡ç¼–è¯‘åéƒ½éœ€è¦è¿è¡Œ `npm run fix:mp-weixin`
2. **è‡ªåŠ¨åŒ–ä»…é™å‘½ä»¤è¡Œæ„å»º**ï¼šåªæœ‰ä½¿ç”¨ `npm run build:mp-weixin` æ‰ä¼šè‡ªåŠ¨ä¿®å¤
3. **å¼€å‘æ¨¡å¼æ‰‹åŠ¨ä¿®å¤**ï¼šwatch æ¨¡å¼æ— æ³•è‡ªåŠ¨æ‰§è¡Œåç»­å‘½ä»¤ï¼Œéœ€æ‰‹åŠ¨ä¿®å¤
4. **å¤‡ä»½æ–‡ä»¶**ï¼šä¿®å¤è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶ï¼Œæ— éœ€æ‹…å¿ƒæ•°æ®ä¸¢å¤±
5. **tabBar å›¾æ ‡è·¯å¾„**ï¼šå¿…é¡»åœ¨ `pages.json` ä¸­æ˜ç¡®æŒ‡å®š `iconPath` å’Œ `selectedIconPath`ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å›¾æ ‡æ‰¾ä¸åˆ°çš„é”™è¯¯

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: tabBar å›¾æ ‡æ‰¾ä¸åˆ°

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: app.json: ["tabBar"]["list"][0]["iconPath"]: "static/images/é¦–é¡µ.png" æœªæ‰¾åˆ°
```

**åŸå› **ï¼š`pages.json` ä¸­çš„ `tabBar.list` æ²¡æœ‰æŒ‡å®šå›¾æ ‡è·¯å¾„ï¼Œä¿®å¤è„šæœ¬ä¼šä½¿ç”¨ `text` å­—æ®µè‡ªåŠ¨ç”Ÿæˆè·¯å¾„ï¼Œä½†å¯èƒ½ä¸å®é™…æ–‡ä»¶åä¸åŒ¹é…ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `pages.json` ä¸­æ˜ç¡®æŒ‡å®šå›¾æ ‡è·¯å¾„ï¼š

```json
"tabBar": {
  "list": [
    { 
      "pagePath": "pages/home/home", 
      "text": "é¦–é¡µ",
      "iconPath": "static/images/home.png",
      "selectedIconPath": "static/images/home-active.png"
    }
  ]
}
```

### é—®é¢˜2: pages ä¸èƒ½ä¸ºç©º

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: app.json: pages ä¸èƒ½ä¸ºç©º
```

**åŸå› **ï¼šuni-app ç¼–è¯‘åç”Ÿæˆçš„ `app.json` ç¼ºå°‘ `pages` é…ç½®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šè¿è¡Œä¿®å¤è„šæœ¬ `npm run fix:mp-weixin`

## ğŸš€ æ¨èå·¥ä½œæµ

### å¼€å‘é˜¶æ®µ
```bash
# æ–¹å¼1: ä½¿ç”¨ HBuilderX å¯è§†åŒ–ç¼–è¯‘
# 1. åœ¨ HBuilderX ä¸­è¿è¡Œåˆ°å¾®ä¿¡å¼€å‘è€…å·¥å…·
# 2. ç¼–è¯‘å®Œæˆåæ‰§è¡Œ: npm run fix:mp-weixin

# æ–¹å¼2: çº¯å‘½ä»¤è¡Œ
# Terminal 1: å¼€å‘æ¨¡å¼ï¼ˆæ— éœ€æ­¤æ­¥éª¤ï¼Œç›´æ¥ç”¨ HBuilderXï¼‰
# npm run dev:mp-weixin

# Terminal 2: é¦–æ¬¡ç¼–è¯‘åä¿®å¤ä¸€æ¬¡
npm run fix:mp-weixin
```

### ç”Ÿäº§æ„å»º
```bash
# ä¸€æ¡å‘½ä»¤æå®šï¼Œè‡ªåŠ¨ä¿®å¤
npm run build:mp-weixin
```

## ğŸ“ é—®é¢˜æ’æŸ¥

å¦‚æœä¿®å¤åä»æœ‰é—®é¢˜ï¼š

1. **æ£€æŸ¥ pages.json**ï¼šç¡®ä¿æºæ–‡ä»¶é…ç½®æ­£ç¡®
2. **æ¸…ç†ç¼“å­˜**ï¼š
   ```bash
   # åˆ é™¤ç¼–è¯‘ç›®å½•
   rm -rf unpackage/dist/dev/mp-weixin
   # é‡æ–°ç¼–è¯‘
   npm run build:mp-weixin
   ```
3. **æŸ¥çœ‹å¤‡ä»½**ï¼šæ£€æŸ¥ `app-backup.json` å¯¹æ¯”å·®å¼‚
4. **å¾®ä¿¡å¼€å‘è€…å·¥å…·**ï¼šå°è¯•æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°ç¼–è¯‘

## ğŸ“„ ç›¸å…³æ–‡ä»¶

- ä¿®å¤è„šæœ¬ï¼š`tools/fix-mp-weixin-build.js`
- æºé…ç½®ï¼š`pages.json`
- ç›®æ ‡æ–‡ä»¶ï¼š`unpackage/dist/dev/mp-weixin/app.json`
- åŒ…é…ç½®ï¼š`package.json` (scripts éƒ¨åˆ†)

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-10-13

