# WS-M0-001: 自检清单 (SELF-REVIEW)

**工作流ID**: WS-M0-001  
**审核人**: _______  
**审核日期**: _______

---

## 一、工程硬约束检查（必须全部✅）

### 1.1 构建检查

- [ ] ✅ **构建 0 报错**
  ```bash
  npm run build:mp-weixin
  # 预期: Build complete. 无error
  ```
  - 开发环境构建: ⬜ 通过
  - 生产环境构建: ⬜ 通过
  - 构建日志: 无error，无critical warning

### 1.2 UI组件库统一

- [ ] ✅ **uView 2.x 唯一**
  ```bash
  node tools/check-ui-consistency.js
  # 预期: ✅ 检查通过，未发现uni-ui混用
  ```
  - uView已安装: ⬜ ^2.0.36
  - 无uni-ui组件混用: ⬜ 是
  - 所有u-组件可引用: ⬜ 是

### 1.3 Node环境检查

- [ ] ✅ **Node 16 CJS**
  ```bash
  node tools/check-engines.js
  # 预期: Node 16.x, ✅ 检查通过
  ```
  - Node版本: ⬜ v16.x.x
  - 云函数使用CJS: ⬜ N/A（本工作流不涉及）

### 1.4 数据路径检查

- [ ] ✅ **前端不直连 Supabase**
  ```bash
  grep -r "createClient" pages/ components/ utils/ --include="*.vue" --include="*.js"
  grep -r "@supabase" pages/ components/ utils/ --include="*.vue" --include="*.js"
  # 预期: 无结果
  ```
  - pages/ 无Supabase引用: ⬜ 是
  - components/ 无Supabase引用: ⬜ 是
  - utils/ 无Supabase引用: ⬜ 是

### 1.5 密钥安全检查

- [ ] ✅ **无明文密钥**
  ```bash
  grep -r "sk-" . --include="*.vue" --include="*.js" --exclude-dir=node_modules
  grep -r "service_role" pages/ components/ utils/ --include="*.vue" --include="*.js"
  # 预期: 无结果（或仅在云函数配置中）
  ```
  - 前端无API Key: ⬜ 是
  - 前端无service_role_key: ⬜ 是

### 1.6 隐私保护检查

- [ ] ✅ **语音不落盘原音频**
  - 本工作流不涉及: ⬜ N/A

### 1.7 包体积检查

- [ ] ✅ **首包 ≤2MB**
  ```bash
  du -sk unpackage/dist/build/mp-weixin/ | awk '{print $1 "KB"}'
  # 预期: < 2048KB
  ```
  - 主包大小: ⬜ ___KB（目标<2048KB）
  - 首包增长: ⬜ ___KB（uView增加）
  - 是否超标: ⬜ 否

### 1.8 性能检查

- [ ] ✅ **关键路径 P95 ≤800ms**
  - 首屏加载: ⬜ ___ms（目标<2000ms）
  - 页面切换: ⬜ ___ms（目标<500ms）
  - 组件渲染: ⬜ ___ms（目标<300ms）

### 1.9 回归测试

- [ ] ✅ **回归脚本通过**
  ```bash
  ./test-ws-m0-001.sh
  # 预期: ✅ 所有自动化检查通过
  ```
  - 环境检查: ⬜ 通过
  - UI一致性检查: ⬜ 通过
  - 依赖检查: ⬜ 通过
  - 构建测试: ⬜ 通过
  - 包体积检查: ⬜ 通过

---

## 二、代码质量检查

### 2.1 ESLint规则

- [ ] **ESLint检查通过**
  ```bash
  npm run lint
  # 或
  npx eslint pages/ components/ utils/
  ```
  - 0 errors: ⬜ 是
  - Warnings < 10: ⬜ 是

### 2.2 代码规范

- [ ] **代码符合Prettier规范**
  ```bash
  npx prettier --check "**/*.{js,vue}"
  ```
  - 格式化一致: ⬜ 是

- [ ] **命名规范**
  - 文件命名: kebab-case ⬜
  - 组件命名: PascalCase ⬜
  - 变量命名: camelCase ⬜
  - 常量命名: UPPER_SNAKE_CASE ⬜

### 2.3 注释完整性

- [ ] **关键函数有注释**
  - tools/check-ui-consistency.js: ⬜ 有JSDoc注释
  - .eslintrc.js: ⬜ 有规则说明注释
  
- [ ] **复杂逻辑有说明**
  - easycom配置: ⬜ 有注释说明

### 2.4 TypeScript/PropTypes

- [ ] **组件PropTypes完整**
  - N/A（本工作流不涉及新组件）: ⬜

---

## 三、功能完整性检查

### 3.1 核心功能

- [ ] **uView安装完成**
  - package.json中有依赖: ⬜ 是
  - node_modules中有uview-ui: ⬜ 是
  - 版本正确: ⬜ ^2.0.36

- [ ] **配置文件修改完成**
  - main.js引入uView: ⬜ 是
  - pages.json配置easycom: ⬜ 是
  - uni.scss引入theme.scss: ⬜ 是
  - App.vue引入index.scss: ⬜ 是

- [ ] **检查脚本开发完成**
  - tools/check-ui-consistency.js存在: ⬜ 是
  - 脚本可正常运行: ⬜ 是
  - 输出格式正确: ⬜ 是

- [ ] **ESLint规则配置**
  - .eslintrc.js存在: ⬜ 是
  - 规则配置正确: ⬜ 是
  - 可检测uni-ui混用: ⬜ 是

- [ ] **文档编写完成**
  - docs/ui-component-guide.md存在: ⬜ 是
  - 内容完整: ⬜ 是
  - 示例清晰: ⬜ 是

### 3.2 页面验证

- [ ] **pages/user/home.vue**
  - u-popup可正常打开: ⬜ 是
  - u-switch可正常切换: ⬜ 是
  - 样式保持一致: ⬜ 是

- [ ] **pages/features/features.vue**
  - u-icon可正常显示: ⬜ 是
  - 图标颜色正确: ⬜ 是

- [ ] **components/scale/ScaleRunner.vue**
  - u-input可正常输入: ⬜ 是
  - 输入验证正常: ⬜ 是

- [ ] **pages/cdk/redeem.vue**
  - CDK输入正常: ⬜ 是
  - 按钮点击正常: ⬜ 是

---

## 四、测试覆盖检查

### 4.1 自动化测试

- [ ] **检查脚本测试**
  - check-ui-consistency.js有测试逻辑: ⬜ 是
  - 测试覆盖正常/异常场景: ⬜ 是

### 4.2 手动测试

- [ ] **功能测试完成**
  - 4个页面逐一测试: ⬜ 是
  - 所有u-组件可用: ⬜ 是
  - 无UI错位: ⬜ 是

- [ ] **兼容性测试**
  - 微信小程序: ⬜ 通过
  - H5: ⬜ 通过
  - APP: ⬜ 通过（可选）

### 4.3 回归测试

- [ ] **原有功能无影响**
  - 登录流程: ⬜ 正常
  - 评估功能: ⬜ 正常
  - 用户中心: ⬜ 正常

---

## 五、文档完整性检查

### 5.1 必需文档

- [ ] **PLAN.md**
  - 存在: ⬜ 是
  - 内容完整: ⬜ 是
  - 依赖关系清晰: ⬜ 是

- [ ] **PATCH.md**
  - 存在: ⬜ 是
  - 代码差异清晰: ⬜ 是
  - 变更说明完整: ⬜ 是

- [ ] **TESTS.md**
  - 存在: ⬜ 是
  - 测试用例完整: ⬜ 是
  - 验证方法清晰: ⬜ 是

- [ ] **SELF-REVIEW.md**（本文档）
  - 存在: ⬜ 是
  - 检查项完整: ⬜ 是

- [ ] **ROLLBACK.md**
  - 存在: ⬜ 是
  - 回滚步骤清晰: ⬜ 是

### 5.2 技术文档

- [ ] **docs/ui-component-guide.md**
  - 组件清单完整: ⬜ 是
  - 使用示例清晰: ⬜ 是
  - 常见问题有答案: ⬜ 是

### 5.3 注释文档

- [ ] **代码注释**
  - 关键函数有注释: ⬜ 是
  - 复杂逻辑有说明: ⬜ 是
  - JSDoc格式规范: ⬜ 是

---

## 六、Git提交检查

### 6.1 分支管理

- [ ] **分支命名正确**
  - 分支名: ⬜ `feat/WS-M0-001-ui-lib-unify`
  - 从main/master分支切出: ⬜ 是

### 6.2 提交信息

- [ ] **Commit信息规范**
  ```
  feat(WS-M0-001): 统一UI组件库到uView 2.x
  
  - 安装uView 2.x
  - 配置easycom自动引入
  - 验证4个页面组件可用
  - 新增UI一致性检查脚本
  - 配置ESLint规则
  - 编写UI组件使用指南
  ```
  - 格式符合Conventional Commits: ⬜ 是
  - 变更说明清晰: ⬜ 是

### 6.3 文件变更

- [ ] **变更文件合理**
  - 无多余文件: ⬜ 是
  - 无调试代码: ⬜ 是
  - 无console.log（除必要日志）: ⬜ 是
  - .gitignore正确: ⬜ 是

---

## 七、安全检查

### 7.1 依赖安全

- [ ] **依赖无已知漏洞**
  ```bash
  npm audit
  # 预期: 0 vulnerabilities
  ```
  - High/Critical漏洞: ⬜ 0个
  - 可选择性修复: ⬜ 已处理

### 7.2 代码安全

- [ ] **无敏感信息泄露**
  - 无硬编码密钥: ⬜ 是
  - 无个人信息: ⬜ 是
  - 无内部URL: ⬜ 是

---

## 八、性能检查

### 8.1 构建性能

- [ ] **构建时间合理**
  - 开发构建: ⬜ < 1min
  - 生产构建: ⬜ < 3min

### 8.2 运行时性能

- [ ] **页面性能**
  - 首屏加载: ⬜ < 2s
  - 页面切换: ⬜ < 500ms
  - 无明显卡顿: ⬜ 是

### 8.3 资源优化

- [ ] **静态资源**
  - 图片大小合理: ⬜ N/A
  - 代码体积合理: ⬜ 是（uView约500KB）

---

## 九、验收标准（最终确认）

### 9.1 核心目标

- [ ] ✅ uView 2.x正确安装并配置
- [ ] ✅ 4个文件组件可正常使用
- [ ] ✅ 检查脚本可自动检测混用
- [ ] ✅ ESLint规则强制uView
- [ ] ✅ 文档完整清晰

### 9.2 质量标准

- [ ] ✅ 构建0报错
- [ ] ✅ ESLint 0 errors
- [ ] ✅ 所有测试通过
- [ ] ✅ 包体积增长<500KB
- [ ] ✅ 性能无明显下降

### 9.3 后续任务准备

- [ ] ✅ WS-M0-002可依赖本工作流的ESLint配置
- [ ] ✅ WS-M1-W1-001可正常使用uView组件
- [ ] ✅ 团队成员了解UI组件使用规范

---

## 十、自检结论

### 10.1 检查结果

**工程硬约束（9项）**: ___ / 9 ✅  
**代码质量**: ___ / 4 ✅  
**功能完整性**: ___ / 8 ✅  
**测试覆盖**: ___ / 3 ✅  
**文档完整性**: ___ / 8 ✅  

**总计**: ___ / 32 ✅

### 10.2 最终结论

- [ ] ✅ **通过** - 所有检查项通过，可以提交PR
- [ ] ⚠️  **有问题** - 发现 ___ 个问题，需修复后重审
- [ ] ❌ **不通过** - 严重问题，需重新开发

### 10.3 发现问题清单

如有问题，请列出：

| 编号 | 问题描述 | 优先级 | 状态 | 备注 |
|------|----------|--------|------|------|
| 1 | | P_ | 待修复 | |
| 2 | | P_ | 待修复 | |

### 10.4 风险提示

- [ ] 无风险
- [ ] 有风险，已记录在PLAN.md风险管理部分

---

## 十一、审核签字

### 自检人

- **姓名**: _______
- **日期**: _______
- **结论**: [ ] 通过  [ ] 有问题  [ ] 不通过

### Code Review人

- **姓名**: _______
- **日期**: _______
- **结论**: [ ] 通过  [ ] 有问题  [ ] 不通过
- **意见**: _______

### 测试验收人

- **姓名**: _______
- **日期**: _______
- **结论**: [ ] 通过  [ ] 有问题  [ ] 不通过
- **测试报告**: _______

### Tech Lead审批

- **姓名**: _______
- **日期**: _______
- **批准合并**: [ ] 是  [ ] 否
- **备注**: _______

---

**自检状态**: 待完成  
**最后更新**: _______

