<view class="chat-page data-v-ccbcd004"><view class="top-actions data-v-ccbcd004"><view class="title-wrapper data-v-ccbcd004"><text class="page-title data-v-ccbcd004">AI心理支持</text><view data-event-opts="{{[['tap',[['showSessionList',['$event']]]]]}}" class="session-indicator data-v-ccbcd004" bindtap="__e"><text class="session-name data-v-ccbcd004">{{currentSessionName}}</text><u-icon vue-id="cadc2e70-1" name="arrow-down" size="12" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view><view class="action-buttons data-v-ccbcd004"><view data-event-opts="{{[['tap',[['handleNewSession',['$event']]]]]}}" class="action-btn data-v-ccbcd004" bindtap="__e"><u-icon vue-id="cadc2e70-2" name="plus" size="18" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view><view data-event-opts="{{[['tap',[['handleClearChat',['$event']]]]]}}" class="action-btn data-v-ccbcd004" bindtap="__e"><u-icon vue-id="cadc2e70-3" name="trash" size="18" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view></view><u-popup bind:input="__e" vue-id="cadc2e70-4" mode="bottom" safe-area-inset-bottom="{{true}}" value="{{showSessionPopup}}" data-event-opts="{{[['^input',[['__set_model',['','showSessionPopup','$event',[]]]]]]}}" class="data-v-ccbcd004" bind:__l="__l" vue-slots="{{['default']}}"><view class="session-popup data-v-ccbcd004"><view class="popup-header data-v-ccbcd004"><text class="popup-title data-v-ccbcd004">会话列表</text><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="popup-close data-v-ccbcd004" bindtap="__e"><u-icon vue-id="{{('cadc2e70-5')+','+('cadc2e70-4')}}" name="close" size="18" color="#1D1D1F" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view><scroll-view class="session-list data-v-ccbcd004" scroll-y="{{true}}"><block wx:for="{{$root.l0}}" wx:for-item="session" wx:for-index="index" wx:key="id"><view data-event-opts="{{[['tap',[['switchSession',['$0'],[[['sessions','id',session.$orig.id]]]]]]]}}" class="{{['session-item','data-v-ccbcd004',(session.$orig.id===sessionId)?'active':'']}}" bindtap="__e"><view class="session-info data-v-ccbcd004"><text class="session-name data-v-ccbcd004">{{session.$orig.name}}</text><text class="session-time data-v-ccbcd004">{{session.m0}}</text></view><block wx:if="{{session.$orig.id!=='default'}}"><view class="session-actions data-v-ccbcd004"><view data-event-opts="{{[['tap',[['renameSession',['$0'],[[['sessions','id',session.$orig.id]]]]]]]}}" class="action-icon data-v-ccbcd004" catchtap="__e"><u-icon vue-id="{{('cadc2e70-6-'+index)+','+('cadc2e70-4')}}" name="edit-pen" size="16" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view><view data-event-opts="{{[['tap',[['deleteSession',['$0'],[[['sessions','id',session.$orig.id]]]]]]]}}" class="action-icon data-v-ccbcd004" catchtap="__e"><u-icon vue-id="{{('cadc2e70-7-'+index)+','+('cadc2e70-4')}}" name="trash" size="16" color="#DC3545" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view></block></view></block></scroll-view></view></u-popup><scroll-view class="message-list data-v-ccbcd004" scroll-y="{{true}}" scroll-into-view="{{scrollIntoView}}" scroll-with-animation="{{true}}"><block wx:if="{{$root.g0===0}}"><view class="empty-state data-v-ccbcd004"><u-icon vue-id="cadc2e70-8" name="chat" size="64" color="#C7C7CC" class="data-v-ccbcd004" bind:__l="__l"></u-icon><text class="empty-text data-v-ccbcd004">开始与AI进行心理倾诉对话</text><text class="empty-hint data-v-ccbcd004">我会倾听您的心声，给予支持和建议</text></view></block><block wx:for="{{$root.l1}}" wx:for-item="msg" wx:for-index="index" wx:key="index"><view class="message-item data-v-ccbcd004" id="{{msg.m1}}"><block wx:if="{{msg.$orig.role==='user'}}"><view class="message user-message data-v-ccbcd004"><view class="message-content-wrapper data-v-ccbcd004"><view data-event-opts="{{[['longpress',[['handleLongPress',['$0',index],[[['messages','',index]]]]]]]}}" class="message-content data-v-ccbcd004" bindlongpress="__e"><text class="data-v-ccbcd004">{{msg.$orig.content}}</text><block wx:if="{{msg.$orig.isFavorite}}"><view class="favorite-badge data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-9-'+index}}" name="star-fill" size="12" color="#FFB800" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></block><block wx:if="{{msg.$orig.sendStatus==='sending'}}"><view class="status-indicator data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-10-'+index}}" name="loading" size="12" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></block><block wx:if="{{msg.$orig.isRevoked}}"><view class="revoked-indicator data-v-ccbcd004"><text class="revoked-text data-v-ccbcd004">已撤回</text></view></block></view><block wx:if="{{msg.m2}}"><view data-event-opts="{{[['tap',[['revokeMessage',[index]]]]]}}" class="revoke-btn data-v-ccbcd004" bindtap="__e"><u-icon vue-id="{{'cadc2e70-11-'+index}}" name="close" size="12" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon><text class="revoke-text data-v-ccbcd004">撤回</text></view></block><block wx:if="{{msg.$orig.sendStatus==='failed'}}"><view data-event-opts="{{[['tap',[['resendMessage',[index]]]]]}}" class="retry-btn data-v-ccbcd004" bindtap="__e"><u-icon vue-id="{{'cadc2e70-12-'+index}}" name="reload" size="14" color="#DC3545" class="data-v-ccbcd004" bind:__l="__l"></u-icon><text class="retry-text data-v-ccbcd004">重发</text></view></block></view><view class="message-avatar data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-13-'+index}}" name="account" size="20" color="#FFFFFF" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view></block><block wx:else><view class="message ai-message data-v-ccbcd004"><view class="message-avatar ai-avatar data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-14-'+index}}" name="star" size="20" color="#FFFFFF" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view><view class="ai-message-wrapper data-v-ccbcd004"><view data-event-opts="{{[['longpress',[['handleLongPress',['$0',index],[[['messages','',index]]]]]]]}}" class="message-content data-v-ccbcd004" bindlongpress="__e"><text class="data-v-ccbcd004">{{msg.$orig.content}}</text><block wx:if="{{msg.$orig.isFavorite}}"><view class="favorite-badge data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-15-'+index}}" name="star-fill" size="12" color="#FFB800" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></block></view><view class="message-rating data-v-ccbcd004"><block wx:if="{{!msg.$orig.rating}}"><view data-event-opts="{{[['tap',[['showRatingDialog',['$0',index],[[['messages','',index]]]]]]]}}" class="rating-prompt data-v-ccbcd004" bindtap="__e"><u-icon vue-id="{{'cadc2e70-16-'+index}}" name="thumb-up" size="14" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon><text class="rating-text data-v-ccbcd004">觉得这个回复怎么样？</text></view></block><block wx:else><view class="rating-result data-v-ccbcd004"><u-icon vue-id="{{'cadc2e70-17-'+index}}" name="{{msg.$orig.rating==='good'?'thumb-up-fill':'thumb-down-fill'}}" size="14" color="{{msg.$orig.rating==='good'?'#34C759':'#FF3B30'}}" class="data-v-ccbcd004" bind:__l="__l"></u-icon><text class="rating-text rated data-v-ccbcd004">已评价</text></view></block></view></view></view></block></view></block><block wx:if="{{isTyping}}"><view class="message ai-message data-v-ccbcd004"><view class="message-avatar ai-avatar data-v-ccbcd004"><u-icon vue-id="cadc2e70-18" name="star" size="20" color="#FFFFFF" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view><view class="message-content typing-indicator data-v-ccbcd004"><view class="dot data-v-ccbcd004"></view><view class="dot data-v-ccbcd004"></view><view class="dot data-v-ccbcd004"></view></view></view></block></scroll-view><view class="input-bar data-v-ccbcd004"><view class="input-wrapper data-v-ccbcd004"><view class="input-toolbar data-v-ccbcd004"><view data-event-opts="{{[['tap',[['toggleEmojiPicker',['$event']]]]]}}" class="toolbar-btn data-v-ccbcd004" bindtap="__e"><u-icon vue-id="cadc2e70-19" name="smile" size="22" color="#8E8E93" class="data-v-ccbcd004" bind:__l="__l"></u-icon></view></view><textarea class="input-field data-v-ccbcd004" placeholder="输入您想说的话..." auto-height="{{true}}" maxlength="{{500}}" show-confirm-bar="{{false}}" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','inputText','$event',[]]]]]]}}" value="{{inputText}}" bindconfirm="__e" bindinput="__e"></textarea><view class="input-actions data-v-ccbcd004"><text class="char-count data-v-ccbcd004">{{$root.g1+"/500"}}</text><button class="send-btn data-v-ccbcd004" disabled="{{$root.g2}}" data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" bindtap="__e"><u-icon vue-id="cadc2e70-20" name="arrow-up" size="20" color="#FFFFFF" class="data-v-ccbcd004" bind:__l="__l"></u-icon></button></view></view><block wx:if="{{showEmojiPicker}}"><view class="emoji-picker data-v-ccbcd004"><view class="emoji-grid data-v-ccbcd004"><block wx:for="{{emojiList}}" wx:for-item="emoji" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['insertEmoji',['$0'],[[['emojiList','',index]]]]]]]}}" class="emoji-item data-v-ccbcd004" bindtap="__e">{{''+emoji+''}}</view></block></view></view></block></view></view>