# 常见问题修复补丁

## 1. CORS问题修复
所有云函数已包含CORS头设置：
```javascript
headers: {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization'
}
```

## 2. 域名配置
需要在manifest.json中配置合法域名：
```json
{
  "mp-weixin": {
    "request": ["https://your-unicloud-domain.com"],
    "downloadFile": ["https://your-unicloud-domain.com"]
  }
}
```

## 3. 音频播放权限
已在manifest.json中添加：
```json
{
  "mp-weixin": {
    "requiredBackgroundModes": ["audio"]
  }
}
```

## 4. 网络超时配置
已设置合理的超时时间：
```json
{
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 30000
  }
}
```

## 5. 路由大小写一致性
所有路由路径已统一使用小写+连字符格式：
- /pages/cdk/redeem
- /pages/cdk/admin-batch
- /pages/music/index
- /pages/music/player
- /pages/admin/metrics

## 6. 环境变量配置
需要在uniCloud控制台配置环境变量：
- JWT_SECRET: JWT密钥
- BASE_URL: API基础地址

## 7. 数据库权限
确保数据库表有正确的读写权限配置。

## 8. 小程序审核注意事项
- 音频播放功能需要在小程序审核时说明用途
- 兑换码功能可能需要相关资质
- 统计功能仅限管理员使用